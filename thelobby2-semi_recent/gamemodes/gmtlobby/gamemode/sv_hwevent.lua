
local BucketPos = {
	Vector(4662.3037109375, -0.080654121935368, -901.96875),
	Vector(4684.4755859375, -2083.2175292969, -901.96875),
	Vector(5249.939453125, -1978.1398925781, -895.21563720703),
	Vector(4885.5791015625, -911.02587890625, -895.96875),
	Vector(4893.7924804688, 891.95324707031, -895.96875),
	Vector(5191.2250976563, 2153.9187011719, -895.96875),
	Vector(3574.5539550781, 2354.1513671875, -901.96875),
	Vector(2782.1928710938, 1461.6840820313, -895.96875),
	Vector(2244.3549804688, 1740.40625, -895.96875),
	Vector(2963.306640625, 1815.4583740234, -895.14819335938),
	Vector(3116.4638671875, -918.18707275391, -855.94262695313),
	Vector(3214.4450683594, -1096.6905517578, -901.96875),
	Vector(3104.2734375, -1901.3547363281, -901.96875),
	Vector(4189.5751953125, -2348.0046386719, -901.96875),
	Vector(4660.134765625, -3233.0107421875, -895.52478027344),
	Vector(4158.66796875, -3577.2053222656, -895.96875),
	Vector(4612.94140625, -4436.8798828125, -895.00695800781),
	Vector(4024.0229492188, -5340.1967773438, -895.96875),
	Vector(5519.068359375, -5597.4887695313, -895.96875),
	Vector(6420.6772460938, -5130.65625, -894.96875),
	Vector(5402.5600585938, -3659.4387207031, -879.19622802734),
	Vector(2731.3955078125, -2084.5280761719, -847.46850585938),
	Vector(1391.2030029297, -1771.7574462891, -511.96875),
	Vector(2811.8774414063, -2058.9086914063, -511.96875),
	Vector(2835.8627929688, -2888.8322753906, -511.96875),
	Vector(344.07662963867, -2154.1997070313, -671.94573974609),
	Vector(163.64788818359, -1700.1358642578, -671.96875),
	Vector(-455.46478271484, -1939.1512451172, -663.59307861328),
	Vector(-1763.560546875, -1163.5889892578, -624.76403808594),
	Vector(-589.89294433594, -1362.6450195313, -847.96875),
	Vector(-531.29974365234, -984.89050292969, -847.96875),
	Vector(-1224.5224609375, -255.69709777832, -901.30853271484),
	Vector(310.76672363281, 252.93328857422, -901.96875),
	Vector(884.59967041016, 631.17053222656, -671.96875),
	Vector(-252.86311340332, 1688.1309814453, -629.91876220703),
	Vector(-994.63116455078, 1278.3071289063, -895.96875),
	Vector(386.55755615234, 1911.3979492188, -671.96875),
	Vector(876.64404296875, 1683.4658203125, -671.96875),
	Vector(538.33544921875, 935.44812011719, -663.08520507813),
	Vector(3713.2211914063, 1225.2890625, -627.99926757813),
	Vector(5307.0029296875, 94.978034973145, -607.96875),
	Vector(5636.548828125, 1461.2728271484, -607.96875),
	Vector(6254.7084960938, 2653.3430175781, -607.96875),
	Vector(6746.8510742188, 2945.0405273438, -607.94122314453),
	Vector(7539.3876953125, 2806.6643066406, -606.68072509766),
	Vector(6375.9174804688, 521.83502197266, -568.48364257813),
	Vector(6359.0112304688, -1194.5595703125, -591.74853515625),
	Vector(6944.2104492188, -463.66644287109, -327.96875),
	Vector(6946.8012695313, 199.66760253906, -327.96875),
	Vector(7688.2006835938, 483.84118652344, -607.96875),
	Vector(-1740.2359619141, 309.45733642578, 14983.03125),
	Vector(-2076.2790527344, -779.55316162109, 15127.03125),
	Vector(-2418.396484375, -303.35406494141, 15303.03125),
	Vector(-3972.1499023438, 420.81353759766, 14983.03125),
	Vector(-2027.7006835938, 1675.8731689453, 14983.03125),
	Vector(-3255.3674316406, 1138.8698730469, 15177.03125),
	Vector(6761.76171875, 4.9383749961853, -1076.9935302734),
	Vector(7665.2265625, 873.34533691406, -1279.96875),
	Vector(3043.3803710938, 3087.8684082031, -895.96875),
	Vector(3056.6940917969, 3182.2683105469, -895.96875),
	Vector(1989.9852294922, 1676.4892578125, -519.30279541016),
	Vector(-3727.5036621094, -531.97454833984, -931.91156005859),
	Vector(-4481.9936523438, 517.642578125, -956.38757324219),
	Vector(-3946.4658203125, 1428.798828125, -938.98864746094),
	Vector(-4068.2094726563, 2525.5688476563, -895.96875),
	Vector(-3937.9946289063, 2960.8989257813, -895.73413085938),
	Vector(-6067.1040039063, 2879.404296875, -895.96875),
	Vector(-6751.3701171875, 3221.9501953125, -895.96875),
	Vector(-7098.1762695313, 911.75085449219, -895.96875),
	Vector(-4734.8354492188, -1041.4931640625, -895.97253417969),
	Vector(-3259.1396484375, -3831.0981445313, -560.22607421875),
	Vector(-4215.3901367188, -4712.2514648438, -231.96875),
	Vector(1797.8284912109, -2390.0869140625, 448.03125),
	Vector(5522.140625, -2997.0756835938, -720.61572265625),
	Vector(4997.0639648438, -2827.1313476563, -720.61572265625),
}

local UsedPos = {}

concommand.Add("gmt_candybuckets",function( ply, commands, args )
	if ply != NULL && !ply:IsAdmin() then return end
	UsedPos = {}

	for i=1, (#BucketPos/2) do

		local pos = table.Random(BucketPos)

		if UsedPos[pos] and IsValid(UsedPos[pos]) then

			for k,v in pairs(BucketPos) do
				if UsedPos[v] and IsValid(UsedPos[v]) then
					continue
				else
					pos = v
				end
			end

		end

		local bucket = ents.Create("gmt_item_bucket")
		bucket:SetPos( pos )
		bucket:Spawn()
		UsedPos[pos] = bucket

	end

	GAMEMODE:ColorNotifyAll( "Candy Buckets have spawned around the plaza! Use your Paranormal Detector to find them.", Color(255, 140, 0, 255) )

	timer.Simple( 5*60, function()
		for k,v in pairs( ents.FindByClass("gmt_item_bucket") ) do
			v:Remove()
		end
		GAMEMODE:ColorNotifyAll( "The Candy Buckets disappeared...", Color(255, 140, 0, 255) )
	end )
end)

hook.Add( "InitPostEntity", "InitializeHalloween", function()

	if !IsHalloweenMap() then return end
	// It's Halloween!
	print("-==INITIALIZING HALLOWEEN EVENT==-")
	timer.Create( "BucketSpawner", 60*30, 0, function()
		UsedPos = {}

		for i=1, (#BucketPos/2) do

			local pos = table.Random(BucketPos)

			if UsedPos[pos] and IsValid(UsedPos[pos]) then

			for k,v in pairs(BucketPos) do
				if UsedPos[v] and IsValid(UsedPos[v]) then
					continue
				else
					pos = v
				end
			end

			end

			local bucket = ents.Create("gmt_item_bucket")
			bucket:SetPos( pos )
			bucket:Spawn()
			UsedPos[pos] = bucket
		end

		GAMEMODE:ColorNotifyAll( "Candy Buckets have spawned around the plaza! Use your Paranormal Detector to find them.", Color(255, 140, 0, 255) )

		timer.Simple( 5*60, function()
			for k,v in pairs( ents.FindByClass("gmt_item_bucket") ) do
				v:Remove()
			end
			GAMEMODE:ColorNotifyAll( "The Candy Buckets disappeared...", Color(255, 140, 0, 255) )
		end )
	end)

end)
